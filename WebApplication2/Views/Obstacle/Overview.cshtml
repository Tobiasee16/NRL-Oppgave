@model WebApplication2.Models.ObstacleData
@{
    ViewData["Title"] = "Obstacle overview";
}

@section Head {
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

    <style>
        #map-view {
            height: 420px;
        }
    </style>
}

<div class="max-w-4xl mx-auto px-4 py-8 lg:py-10 space-y-8">

    <!-- Tittel -->
    <div class="text-center space-y-1">
        <h1 class="text-3xl md:text-4xl font-semibold tracking-tight text-slate-50">
            Obstacle overview
        </h1>
        <p class="text-sm text-slate-400">
            Summary of the obstacle you just reported.
        </p>
    </div>

    <!-- Kort med detaljer -->
    <section class="rounded-2xl border border-slate-800 bg-slate-900/80 shadow-xl backdrop-blur px-6 py-6 space-y-4">
        <div class="grid gap-4 sm:grid-cols-2">
            <div class="space-y-1">
                <p class="text-xs uppercase tracking-[0.18em] text-slate-400">
                    Name
                </p>
                <p class="text-sm font-medium text-slate-50">
                    @Model.ObstacleName
                </p>
            </div>

            <div class="space-y-1">
                <p class="text-xs uppercase tracking-[0.18em] text-slate-400">
                    Height
                </p>
                <p class="text-sm font-medium text-slate-50">
                    @Model.ObstacleHeight m
                </p>
            </div>
        </div>

        <div class="space-y-1">
            <p class="text-xs uppercase tracking-[0.18em] text-slate-400">
                Description
            </p>
            <p class="text-sm text-slate-200 whitespace-pre-line">
                @Model.ObstacleDescription
            </p>
        </div>
    </section>

    <!-- Kartvisning -->
    @if (!string.IsNullOrWhiteSpace(Model.GeometryGeoJson))
    {
        <section class="space-y-3">
            <div class="flex items-center justify-between">
                <h2 class="text-lg font-semibold text-slate-50">
                    Map view
                </h2>
            </div>

            <div id="map-view"
                 class="rounded-2xl border border-slate-800 bg-slate-950 shadow-inner">
            </div>
        </section>
    }
    else
    {
        <p class="text-sm text-slate-400">
            No map geometry was submitted for this obstacle.
        </p>
    }

    <!-- Navigasjonsknapper -->
    <div class="pt-4 flex flex-col sm:flex-row justify-center gap-4">
        <a asp-controller="Obstacle" asp-action="DataForm"
           class="inline-flex justify-center rounded-xl bg-sky-600 px-6 py-2.5 text-sm font-semibold text-white
                  shadow-lg shadow-sky-500/30 hover:bg-sky-700 active:scale-[0.98]
                  focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-0">
            Register another obstacle
        </a>

        <a asp-controller="Home" asp-action="Index"
           class="inline-flex justify-center rounded-xl border border-slate-700 bg-slate-900 px-6 py-2.5 text-sm font-medium text-slate-100
                  hover:bg-slate-800 hover:border-slate-600
                  focus:outline-none focus:ring-2 focus:ring-sky-500 focus:ring-offset-0">
            Back to home
        </a>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

    @if (!string.IsNullOrWhiteSpace(Model.GeometryGeoJson))
    {
        <script>
            (function () {
                const map = L.map('map-view').setView([59.9139, 10.7522], 10);

                L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 19,
                    attribution: '&copy; OpenStreetMap'
                }).addTo(map);

                try {
                    const raw = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(Model.GeometryGeoJson));
                    if (raw) {
                        const gj = JSON.parse(raw);
                        const layer = L.geoJSON(gj, {
                            style: { color: '#38bdf8', weight: 3 }
                        }).addTo(map);

                        try {
                            const bounds = layer.getBounds();
                            if (bounds && bounds.isValid()) {
                                map.fitBounds(bounds, { padding: [20, 20] });
                            }
                        } catch { }
                    }
                } catch (e) {
                    console.error('Invalid GeoJSON', e);
                }
            })();
        </script>
    }
}
